<!DOCTYPE html>
<html lang="es" class="h-full bg-gray-50">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Red Social IFTS{% endblock %}</title>

    {# Tailwind compilado localmente: se retir√≥ CDN #}

    {% load static %}
    <link href="{% static 'css/output.css' %}" rel="stylesheet" />
    <link href="{% static 'css/app.css' %}" rel="stylesheet" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <script src="https://unpkg.com/heroicons@2.0.18/24/outline/index.js"></script>
    {# TODO: Remover CDN Tailwind cuando output.css incluya todas las clases personalizadas (bg-primary-600, etc.) #}

    <script>
      // Guard anti-fade temprano: evita que se establezca opacity:0 global
      (function(){
        const originalSetAttribute = Element.prototype.setAttribute;
        Element.prototype.setAttribute = function(name, value){
          if(name === 'style' && /opacity:\s*0(?!\d)/.test(value)) {
            console.warn('[guard] Bloqueado setAttribute style con opacity:0 en', this.tagName);
            value = value.replace(/opacity:\s*0(?!\d)/g,'opacity:1 !important');
          }
          return originalSetAttribute.call(this, name, value);
        };
        const originalSetProperty = CSSStyleDeclaration.prototype.setProperty;
        CSSStyleDeclaration.prototype.setProperty = function(prop, val, priority){
          if(prop === 'opacity' && /^0(\.\d+)?$/.test(val)) {
            console.warn('[guard] Bloqueado setProperty opacity=0, forzando 1');
            return originalSetProperty.call(this, prop, '1', 'important');
          }
          return originalSetProperty.call(this, prop, val, priority);
        };
        // Refuerzo inicial inmediato
        document.documentElement.style.opacity = '1';
        document.documentElement.style.transition = 'none';
      })();
    </script>

    {% block extra_css %}{% endblock %}
  </head>
  <body class="min-h-screen">
    {% include 'components/toast.html' %}
    {% if user.is_authenticated %}
      {% include 'components/navbar.html' %}
    {% endif %}

    <div class="flex min-h-screen">
      {% if user.is_authenticated %}
        {% include 'components/sidebar.html' %}
      {% endif %}

      <main class="flex-1 overflow-y-auto bg-gray-50">
          <div class="py-4 sm:py-6">
            <div class="max-w-7xl mx-auto px-3 sm:px-4 lg:px-8">
              {% block breadcrumbs %}{% endblock %}
              {% if messages %}
                <div id="flash-messages">
                  {% for message in messages %}
                    <div
                      class="flash-message mb-4 p-4 rounded-md {% if message.tags == 'error' %}bg-red-50 text-red-700 border border-red-200{% elif message.tags == 'warning' %}bg-yellow-50 text-yellow-700 border border-yellow-200{% elif message.tags == 'success' %}bg-green-50 text-green-700 border border-green-200{% else %}bg-blue-50 text-blue-700 border border-blue-200{% endif %}"
                      role="alert"
                      data-message-tag="{{ message.tags }}"
                    >
                      {{ message }}
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
              {% block content %}{% endblock %}
            </div>
          </div>
        </main>
    </div>

    <script src="{% static 'js/app.js' %}"></script>
    <script src="{% static 'js/gamification.js' %}"></script>
    {% block extra_js %}{% endblock %}
  </body>
</html>
